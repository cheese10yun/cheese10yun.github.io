
<!DOCTYPE html>
<html lang="ko">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="google-site-verification" content="sBAfGubPxv1ol5QEVGgOJ4ggp5spK-zFFXpK-Pd2xZM" />
    <meta name="naver-site-verification" content="a37ea649edf26e70c3de94f9cb034f9d6e11de3f" />
    <meta name="generator" content="Yun Blog">
    <title>Spring Guide - 테스트 전략 - Yun Blog</title>
    <meta name="author" content="Yun">
    
        <meta name="keywords" content="Node,Spring,Spring Boot,Spring Batch,Kotlin,기술 블로그,JPA,Mongo,MySQL,OOP,">
    
    
    
        
            <link rel="alternate" type="application/rss+xml" title="RSS" href="/rss2.xml">
        
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Yun","sameAs":["https://github.com/cheese10yun"],"image":"yun-icon.jpg"},"articleBody":"\n해당 코드는 Github를 확인해주세요.\n\n소개#스프링은 다양한 테스트 전략을 제공하고 있습니다. 대표적으로 Slice Test 라는 것으로 특정 레이어에 대해서 Bean을 최소한으로 등록시켜 테스트 하고자 하는 부분에 최대한 단위 테스트를 지원합니다. 다양하게 지원해주는 만큼 테스트 코드를 통일성 있게 관리하는 것이 중요합니다. 더 안전하고 통일성 있게 테스트를 진행하는 방법에 대해서 제 나름의 노하우를 정리해보았습니다.\n테스트 전략#\n\n\n어노테이션\n설명\n부모 클래스\nBean\n\n\n\n@SpringBootTest\n통합 테스트, 전체\nIntegrationTest\nBean 전체\n\n\n@WebMvcTest\n단위 테스트, Mvc 테스트\nMockApiTest\nMVC 관련된 Bean\n\n\n@DataJpaTest\n단위 테스트, Jpa 테스트\nRepositoryTest\nJPA 관련 Bean\n\n\nNone\n단위 테스트, Service 테스트\nMockTest\nNone\n\n\nNone\nPOJO, 도메인 테스트\nNone\nNone\n\n\n통합테스트#장점#\n모든 Bean을 올리고 테스트를 진행하기 때문에 쉽게 테스트 진행 가능\n모든 Bean을 올리고 테스트를 진행하기 때문에 운영환경과 가장 유사하게 테스트 가능\nAPI를 테스트할 경우 요청부터 응답까지 전체적인 테스트 진행 가능\n\n단점#\n모든 Bean을 올리고 테스트를 진행하기 때문에 테스트 시간이 오래 걸림\n테스트의 단위가 크기 때문에 테스트 실패시 디버깅이 어려움\n외부 API 콜같은 Rollback 처리가 안되는 테스트 진행을 하기 어려움\n\nCode#IntegrationTest#1234567891011@RunWith(SpringRunner.class)@SpringBootTest(classes = ApiApp.class)@AutoConfigureMockMvc@ActiveProfiles(TestProfile.TEST)@Transactional@Ignorepublic class IntegrationTest &#123;    @Autowired protected MockMvc mvc;    @Autowired protected ObjectMapper objectMapper;    ...&#125;\n\n통합 테스트의 Base 클래스입니다. Base 클래스를 통해서 테스트 전략을 통일성 있게 가져갈 수 있습니다.\n통합 테스트는 주로 컨트롤러 테스트를 주로 하며 요청부터 응답까지의 전체 플로우를 테스트합니다.\n@ActiveProfiles(TestProfile.TEST) 설정으로 테스트에 profile을 지정합니다. 환경별로 properties 파일을 관리하듯이 test도 반드시 별도의 properties 파일로 관리하는 것이 바람직합니다.\n인터페이스나 enum 클래스를 통해서 profile을 관리합니다. 오타 실수를 줄일 수 있으며 전체적인 프로필이 몇 개 있는지 한 번에 확인할 수 있습니다.\n@Transactional 트랜잭션 어노테이션을 추가하면 테스트코드의 데이터베이스 정보가 자동으로 Rollback 됩니다. 베이스 클래스에 이 속성을 추가 해야지 실수 없이 진행할 수 있습니다.\n@Transactional을 추가하면 자연스럽게 데이터베이스 상태의존 적인 테스트를 자연스럽게 하지 않을 수 있게 됩니다.\n통합 테스트 시 필요한 기능들을 protected로 제공해줄 수 있습니다. API 테스트를 주로 하게 되니 ObjectMapper 등을 제공해줄 수 있습니다. 유틸성 메서드들도 protected로 제공해주면 중복 코드 및 테스트 코드의 편의성이 높아집니다.\n실제로 동작할 필요가 없으니 @Ignore 어노테이션을 추가합니다.\n\nTest Code#12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758public class MemberApiTest extends IntegrationTest &#123;    @Autowired    private MemberSetup memberSetup;    @Test    public void 회원가입_성공() throws Exception &#123;        //given        final Member member = MemberBuilder.build();        final Email email = member.getEmail();        final Name name = member.getName();        final SignUpRequest dto = SignUpRequestBuilder.build(email, name);        //when        final ResultActions resultActions = requestSignUp(dto);        //then        resultActions                .andExpect(status().isOk())                .andExpect(jsonPath(&quot;email.value&quot;).value(email.getValue()))                .andExpect(jsonPath(&quot;email.host&quot;).value(email.getHost()))                .andExpect(jsonPath(&quot;email.id&quot;).value(email.getId()))                .andExpect(jsonPath(&quot;name.first&quot;).value(name.getFirst()))                .andExpect(jsonPath(&quot;name.middle&quot;).value(name.getMiddle()))                .andExpect(jsonPath(&quot;name.last&quot;).value(name.getLast()))                .andExpect(jsonPath(&quot;name.fullName&quot;).value(name.getFullName()))        ;    &#125;    @Test    public void 회원조회() throws Exception &#123;        //given        final Member member = memberSetup.save();        //when        final ResultActions resultActions = requestGetMember(member.getId());        //then        resultActions                .andExpect(status().isOk())                .andExpect(jsonPath(&quot;email.value&quot;).value(member.getEmail().getValue()))                .andExpect(jsonPath(&quot;email.host&quot;).value(member.getEmail().getHost()))                .andExpect(jsonPath(&quot;email.id&quot;).value(member.getEmail().getId()))                .andExpect(jsonPath(&quot;name.first&quot;).value(member.getName().getFirst()))                .andExpect(jsonPath(&quot;name.middle&quot;).value(member.getName().getMiddle()))                .andExpect(jsonPath(&quot;name.last&quot;).value(member.getName().getLast()))                .andExpect(jsonPath(&quot;name.fullName&quot;).value(member.getName().getFullName()))        ;    &#125;    private ResultActions requestSignUp(SignUpRequest dto) throws Exception &#123;        return mvc.perform(post(&quot;/members&quot;)                .contentType(MediaType.APPLICATION_JSON_UTF8)                .content(objectMapper.writeValueAsString(dto)))                .andDo(print());    &#125;    ...&#125;\n\nIntegrationTest 클래스를 상속받습니다. 이 상속을 통해서 MemberApiTest에서 테스트를 위한 어노테이션이 생략되며 어떤 통합 테스트라도 항상 통일성을 가질 수 있습니다.\ngiven, when, then 키워드로 테스트 흐름을 알려줍니다. 다른 사람의 테스트 코드의 가독성이 높아지기 때문에 해당 키워드로 적절하게 표시하는 것을 권장합니다.\n요청에 대한 메서드를 requestSignUp(...)으로 분리해서 재사용성을 높입니다. 해당 메서드로 valdate 실패하는 케이스도 작성합니다 andDo(print()) 메서드를 추가해서 해당 요청에 대한 출력을 확인합니다. 디버깅에 매우 유용합니다.\n모든 response에 대한 andExpect를 작성합니다. 간혹 .andExpect(content().string(containsString(&quot;&quot;))) 이런 테스트를 진행하는데 특정 문자열이 들어 있는지 없는지 확인하는 것은 것보다 모\nresponse에 하나라도 빠지거나 변경되면 API 변경이 이루어진 것이고 그 변경에 맞게 테스트 코드도 변경되어야 합니다.\n\n\n회원 조회 테스트 강은 경우 memberSetup.save(); 메서드로 테스트전에 데이터베이스에 insert 합니다. \n데이터베이스에 미리 있는 값을 검증하는 것은 데이터베이스 상태에 의존한 코드가 되며 누군가가 회원 정보를 변경하게 되면 테스트 코드가 실패하게 됩니다.\n테스트 전에 데이터를 insert하지 않는다면 테스트 코드 구동 전에 .sql 으로 미리 데이터베이스를 준비시킵니다 ApplicationRunner를 이용해서 데이터베이스를 준비시키 방법도 있습니다.\n중요한 것은 데이터베이스 상태에 너무 의존적인 테스트는 향후 로직의 문제가 없더라도 테스트가 실패하는 상황이 자주 만나게 됩니다.\n\n\n\n서비스 테스트#장점#\n진행하고자 하는 테스트에만 집중할 수 있습니다.\n테스트 진행시 중요 관점이 아닌 것들은 Mocking 처리해서 외부 의존성들을 줄일 수 있습니다.\n예를 들어 주문 할인 로직이 제대로 동작하는지에 대한 테스트만 진행하지 이게 실제로 데이터베이스에 insert되는지는 해당 테스트의 관심사가 아닙니다.\n\n\n테스트 속도가 빠릅니다.\n\n단점#\n의존성 있는 객체를 Mocking 하기 때문에 문제가 완결된 테스트는 아닙니다.\nMocking 하기가 귀찮습니다.\nMocking 라이브러리에 대한 학습 비용이 발생합니다.\n\nCode#MockTest#123456@RunWith(MockitoJUnitRunner.class)@ActiveProfiles(TestProfile.TEST)@Ignorepublic class MockTest &#123;&#125;\n\n주로 Service 영역을 테스트 합니다. \nMockitoJUnitRunner을 통해서 Mock 테스트를 진행합니다.\n\nTest Code#12345678910111213141516171819202122232425262728293031323334353637383940414243444546public class MemberSignUpServiceTest extends MockTest &#123;    @InjectMocks    private MemberSignUpService memberSignUpService;    @Mock    private MemberRepository memberRepository;    private Member member;    @Before    public void setUp() throws Exception &#123;        member = MemberBuilder.build();    &#125;    @Test    public void 회원가입_성공() &#123;        //given        final Email email = member.getEmail();        final Name name = member.getName();        final SignUpRequest dto = SignUpRequestBuilder.build(email, name);        given(memberRepository.existsByEmail(any())).willReturn(false);        given(memberRepository.save(any())).willReturn(member);        //when        final Member signUpMember = memberSignUpService.doSignUp(dto);        //then        assertThat(signUpMember).isNotNull();        assertThat(signUpMember.getEmail().getValue()).isEqualTo(member.getEmail().getValue());        assertThat(signUpMember.getName().getFullName()).isEqualTo(member.getName().getFullName());    &#125;    @Test(expected = EmailDuplicateException.class)    public void 회원가입_이메일중복_경우() &#123;        //given        final Email email = member.getEmail();        final Name name = member.getName();        final SignUpRequest dto = SignUpRequestBuilder.build(email, name);        given(memberRepository.existsByEmail(any())).willReturn(true);        //when        memberSignUpService.doSignUp(dto);    &#125;&#125;\n\nMockTest 객체를 상속받아 테스트의 일관성을 갖습니다.\n회원가입_성공 테스트는 오직 회원 가입에대한 단위 테스트만 진행합니다.\nexistsByEmail을 모킹해서 해당 이메일이 중복되지 않았다는 가정을 합니다.\nthen 에서는 회원 객체가 해당 비즈니스 요구사항에 맞게 생성됬는지를 검사합니다.\n실제 데이터베이스에 Insert 됬는지 여부는 해당 테스트의 관심사가 아닙니다.\n\n\n회원가입_이메일중복_경우 테스트는 회원가입시 이메일이 중복됬는지 여부를 확인합니다.\nexistsByEmail을 모킹해서 이메일이 중복됬다는 가정을 합니다.\nexpected으로 이메일이 중복되었을 경우 EmailDuplicateException 예외가 발생하는지 확인합니다.\n해당 이메일이 데이터베이스에 실제로 있어서 예외가 발생하는지는 관심사가 아닙니다. 작성한 코드가 제대로 동작 여부만이 해당 테스트의 관심사 입니다.\n\n\n오직 테스트의 관심사만 테스트를 진행하기 때문에 예외 발생시 디버깅 작업도 명확해집니다.\n외부 의존도가 낮기 때문에 테스트 하고자하는 부분만 명확하게 테스트가 가능합니다.\n이것은 단점이기도 합니다. 해당 테스트만 진행하지 외부 의존을 갖는 코드까지 테스트하지 않으니 실제 환경에서 제대로 동작하지 않을 가능성이 있습니다. 외부 의존에대한 테스트는 통합 테스트에서 진행합니다.\n\n\n\nMock API 테스트#장점#\nMock 테스트와 장점은 거의 같습니다.\nWebApplication 관련된 Bean들만 등록하기 때문에 통합 테스트보다 빠르게 테스트할 수 있습니다.\n통합 테스트를 진행하기 어려운 테스트를 진행합니다.\n외부 API 같은 Rollback 처리가 힘들거나 불가능한 테스트를 주로 사용합니다.\n예를 들어 외부 결제 모듈 API를 콜하면 안 되는 케이스에서 주로 사용 할 수 있습니다.\n이런 문제는 통합 테스트에서 해당 객체를 Mock 객체로 변경해서 테스트를 변경해서 테스트할 수도 있습니다.\n\n\n\n단점#\nMcok 테스트와 다점은 거의 같습니다.\n요청부터 응답까지 모든 테스트를 Mock 기반으로 테스트하기 때문에 실제 환경에서는 제대로 동작하지 않을 가능성이 매우 큽니다.\n\nCode#12345678910111213141516171819202122232425@WebMvcTest(MemberApi.class)public class MemberMockApiTest extends MockApiTest &#123;    @MockBean private MemberSignUpService memberSignUpService;    @MockBean private MemberHelperService memberHelperService;    ...    @Test    public void 회원가입_유효하지않은_입력값() throws Exception &#123;        //given        final Email email = Email.of(&quot;asdasd@d&quot;); // 이메일 형식이 유효하지 않음        final Name name = Name.builder().build();        final SignUpRequest dto = SignUpRequestBuilder.build(email, name);        final Member member = MemberBuilder.build();        given(memberSignUpService.doSignUp(any())).willReturn(member);        //when        final ResultActions resultActions = requestSignUp(dto);        //then        resultActions                .andExpect(status().isBadRequest())        ;    &#125;\n\n@WebMvcTest(MemberApi.class) 어노테이션을 통해서 하고자하는 MemberApi의 테스트를 진행합니다.\n@MockBean 으로 객체를 주입받아 Mocking 작업을 진행합니다.\n테스트의 관심사는 오직 Request와 그에 따른 Response 입니다.\n\nRepository Test#장점#\nRepository 관련된 Bean들만 등록하기 때문에 통합 테스트에 비해서 빠릅니다.\nRepository에 대한 관심사만 갖기 때문에 테스트 범위가 작습니다.\n\n단점#\n테스트 범위가 작기 때문에 실제 환경과 차이가 발생합니다.\n\nCode#RepositoryTest#1234567@RunWith(SpringRunner.class)@DataJpaTest@ActiveProfiles(TestProfile.TEST)@AutoConfigureTestDatabase(replace = AutoConfigureTestDatabase.Replace.NONE)@Ignorepublic class RepositoryTest &#123;&#125;\n\n@DataJpaTest 어노테이션을 통해서 Repository에 대한 Bean만 등록합니다.\n@DataJpaTest는 기본적으로 메모리 데이터베이스에 대한 테스트를 진행합니다. @AutoConfigureTestDatabase 어노테이션을 통해서 profile에 등록된 데이터베이스 정보로 대체할 수 있습니다.\nJpaRepository에서 기본적으로 기본적으로 제공해주는 findById, findByAll, deleteById등은 테스트를 하지 않습니다.\n기본적으로 save() null 제약 조건등의 테스트는 진행해도 좋다고 생각합니다.\n주로 커스텀하게 작성한 쿼리 메서드, @Query으로 작성된 JPQL등의 커스텀하게 추가된 메서드를 테스트합니다.\n\n\n\nTest Code#1234567891011121314151617181920212223242526272829public class MemberRepositoryTest extends RepositoryTest &#123;    @Autowired    private MemberRepository memberRepository;    private Member saveMember;    private Email email;    @Before    public void setUp() throws Exception &#123;        final String value = &quot;cheese10yun@gmail.com&quot;;        email = EmailBuilder.build(value);        final Name name = NameBuilder.build();        saveMember = memberRepository.save(MemberBuilder.build(email, name));    &#125;    ...    @Test    public void existsByEmail_존재하는경우_true() &#123;        final boolean existsByEmail = memberRepository.existsByEmail(email);        assertThat(existsByEmail).isTrue();    &#125;    @Test    public void existsByEmail_존재하지않은_경우_false() &#123;        final boolean existsByEmail = memberRepository.existsByEmail(Email.of(&quot;ehdgoanfrhkqortntksdls@asd.com&quot;));        assertThat(existsByEmail).isFalse();    &#125;&#125;\n\nsetUp() 메서드를 통해서 Member를 데이터베이스에 insert 합니다.\nsetUp() 메서드는 메번 테스트 코드가 실행되기전에 실행됩니다. 즉 테스트 코드 실핼 할 때마다 insert -&gt; rollback이 자동으로 이루어집니다.\n\n\n추가 작성한 쿼리 메서드 existsByEmail을 테스트 진행합니다. \n실제로 작성된 쿼리가 어떻게 출력되는지 show-sql 옵션을 통해서 확인 합니다. ORM은 SQL을 직접 장성하지 않으니 실제 쿼리가 어떻게 출력되는지 확인하는 습관을 반드시 가져야합니다.\n\n\n\nPOJO 테스트#설명#각 엔티티(Embeddable, Entity, 일반 POJO, 모든 객체) 객체들의 기능이 풍부해야 합니다. 객체 본인의 책임을 충분히 다하지 않고 있으면 다른 영역으로 그 객체의 책임이 넘어 가게됩니다. 예를 들어 Name 객체가 getFullName() 메서드를 제공해주지 않는다면 getFullName() 메서드를 만족시키는 메서드들이 다른 계층에서 구현하게 되고 어느 계층에서 어떻게 사용되고 있는지 모르기 때문에 누군가는 중복코드를 만들게 됩니다.\n객체지향에서 본인의 책임(기능)은 본인 스스로가 제공해야 합니다. 특히 엔티티 객체들은 가장 핵심 객체이고 이 객체를 사용하는 계층들이 다양하게 분포되기 때문에 반드시 테스트 코드를 작성해야합니다.\n장점#\nPOJO 객체이므로 테스트하기 편합니다. 외부에서 주입 받을 의존성도 없고 Mocking할 대상도 없습니다.\n엔티티 객체는 사용하는 계층이 많으므로 테스트의 효율성이 높습니다.\n\n단점#\n단점은 없다고 생각합니다. POJO를 테스트 하므로 테스트 속도 및 난도가 낮지만 높은 안전성을 갖게 됩니다.\n\nCode#Embeddable#12345678910111213141516171819202122232425262728293031@Embeddable@Getter@NoArgsConstructor(access = AccessLevel.PROTECTED)@ToString(of = &#123;&quot;first&quot;, &quot;middle&quot;, &quot;last&quot;&#125;)public class Name &#123;    @NotEmpty    @Column(name = &quot;first_name&quot;, length = 50)    private String first;    @Column(name = &quot;middle_name&quot;, length = 50)    private String middle;    @NotEmpty    @Column(name = &quot;last_name&quot;, length = 50)    private String last;    @Builder    public Name(final String first, final String middle, final String last) &#123;        this.first = first;        this.middle = StringUtils.isEmpty(middle) ? null : middle;        this.last = last;    &#125;    public String getFullName() &#123;        if (this.middle == null) &#123;            return String.format(&quot;%s %s&quot;, this.first, this.last);        &#125;        return String.format(&quot;%s %s %s&quot;, this.first, this.middle, this.last);    &#125;&#125;\n\nName 객체는 Member 객체에서 사용하고 있습니다. 이처럼 Name 이라는 객체를 Embeddable으로 별도로 가지고 있으면 데이터의 응집력 재사용성이 높아집니다.\n예를 들어 주문시 주문자 정보를 받아야 된다면 Order 라는 객체에도 동일하게 Name 객체를 사용하면 재사용성이 높아집니다.\n\n\nEmbeddable 객체에서도 다른 객체와 마찬가지로 Name 관련된 기능을 충분히 제공해야 합니다. getFullName() 메서드 처럼 first, last, middle의 이름을 적절하게 조합해서 제공해줍니다.\n\nTest Code#1234567891011121314151617181920212223242526272829303132333435363738public class NameTest &#123;    @Test    public void getFullName_isFullName_ReturnFullName() &#123;        final Name name = Name.builder()                .first(&quot;first&quot;)                .middle(&quot;middle&quot;)                .last(&quot;last&quot;)                .build();        final String fullName = name.getFullName();        assertThat(fullName, is(&quot;first middle last&quot;));    &#125;    @Test    public void getFullName_WithoutMiddle_ReturnMiddleNameIsNull() &#123;        final Name name = Name.builder()                .first(&quot;first&quot;)                .middle(&quot;&quot;)                .last(&quot;last&quot;)                .build();        final String fullName = name.getFullName();        assertThat(fullName, is(&quot;first last&quot;));        assertThat(name.getMiddle(), is(nullValue()));    &#125;    @Test    public void getFullName_MiddleNameIsNull_ReturnMiddleNameIsNull() &#123;        final Name name = Name.builder()                .first(&quot;first&quot;)                .middle(&quot;&quot;)                .last(&quot;last&quot;)                .build();        final String fullName = name.getFullName();        assertThat(fullName, is(&quot;first last&quot;));        assertThat(name.getMiddle(), is(nullValue()));    &#125;&#125;\n\nentity, Embeddable 객체 등의 객체들도 반드시 테스트 코드를 작성해야합니다.\nmiddle 값이 비어있을 경우 null로 잘들어가는지, getFullName() 메서드가 잘 동작하는지 테스트합니다.\n\n마무리#각자의 프로젝트 환경이 다르기 때문에 어느 한방 법이 Best Practice라고 말하는 게 어렵습니다. 그래도 테스트 코드의 중요성은 이미 많은 개발자가 공감하고 있는 만큼 보다 효율적인 테스트 코드 환경을 구축하려는 노력이 많이 선행되어야 한다고 생각합니다.\n","dateCreated":"2019-02-17T00:35:00+09:00","dateModified":"2025-02-02T13:43:50+09:00","datePublished":"2019-02-17T00:35:00+09:00","description":"스프링은 다양한 테스트 전략을 제공하고 있습니다. 대표적으로 Slice Test 라는 것으로 특정 레이어에 대해서 Bean을 최소한으로 등록시켜 테스트 하고자 하는 부분에 최대한 단위 테스트를 지원합니다.","headline":"Spring Guide - 테스트 전략","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://cheese10yun.github.io/spring-guide-test-1/"},"publisher":{"@type":"Organization","name":"Yun","sameAs":["https://github.com/cheese10yun"],"image":"yun-icon.jpg","logo":{"@type":"ImageObject","url":"yun-icon.jpg"}},"url":"https://cheese10yun.github.io/spring-guide-test-1/","keywords":"Spring, Test"}</script>
    <meta name="description" content="스프링은 다양한 테스트 전략을 제공하고 있습니다. 대표적으로 Slice Test 라는 것으로 특정 레이어에 대해서 Bean을 최소한으로 등록시켜 테스트 하고자 하는 부분에 최대한 단위 테스트를 지원합니다.">
<meta property="og:type" content="blog">
<meta property="og:title" content="Spring Guide - 테스트 전략">
<meta property="og:url" content="https://cheese10yun.github.io/spring-guide-test-1/index.html">
<meta property="og:site_name" content="Yun Blog">
<meta property="og:description" content="스프링은 다양한 테스트 전략을 제공하고 있습니다. 대표적으로 Slice Test 라는 것으로 특정 레이어에 대해서 Bean을 최소한으로 등록시켜 테스트 하고자 하는 부분에 최대한 단위 테스트를 지원합니다.">
<meta property="og:locale" content="ko_KR">
<meta property="article:published_time" content="2019-02-16T15:35:00.000Z">
<meta property="article:modified_time" content="2025-02-02T04:43:50.901Z">
<meta property="article:author" content="Yun">
<meta property="article:tag" content="Spring">
<meta property="article:tag" content="Test">
<meta name="twitter:card" content="summary">
    
    
        
    
    
        <meta property="og:image" content="https://cheese10yun.github.io/assets/images/yun-icon.jpg"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/all.css">

    
<link rel="stylesheet" href="/assets/css/jquery.fancybox.css">

    
<link rel="stylesheet" href="/assets/css/thumbs.css">

    
<link rel="stylesheet" href="/assets/css/tranquilpeak.css">

    
    
<link rel="stylesheet" href="/assets/css/toc.css">

    
    <!--STYLES END-->
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-90907312-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-90907312-1');
    </script>


    

    
        
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5813739623204880" crossorigin="anonymous"></script>
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="5">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            Yun Blog
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="링크 열기: /#about"
            >
        
        
            <img class="header-picture" src="/assets/images/yun-icon.jpg" alt="저자 이미지"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="5">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="저자에 대해 더 알아보기"
                >
                    <img class="sidebar-profile-picture" src="/assets/images/yun-icon.jpg" alt="저자 이미지"/>
                </a>
                <h4 class="sidebar-profile-name">Yun</h4>
                
                    <h5 class="sidebar-profile-bio"><p>기술 블로그</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="태그"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">태그</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="아카이브"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">아카이브</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/cheese10yun"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/rss2.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="5"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            Spring Guide - 테스트 전략
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2019-02-17T00:35:00+09:00">
	
		    2019/02/17
    	
    </time>
    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <blockquote>
<p>해당 코드는 <a target="_blank" rel="noopener" href="https://github.com/cheese10yun/spring-guide">Github</a>를 확인해주세요.</p>
</blockquote>
<h1><span id="sogae">소개</span><a href="#sogae" class="header-anchor">#</a></h1><p>스프링은 다양한 테스트 전략을 제공하고 있습니다. 대표적으로 Slice Test 라는 것으로 특정 레이어에 대해서 Bean을 최소한으로 등록시켜 테스트 하고자 하는 부분에 최대한 단위 테스트를 지원합니다. 다양하게 지원해주는 만큼 테스트 코드를 통일성 있게 관리하는 것이 중요합니다. 더 안전하고 통일성 있게 테스트를 진행하는 방법에 대해서 제 나름의 노하우를 정리해보았습니다.</p>
<h1><span id="teseuteu-jeonryag">테스트 전략</span><a href="#teseuteu-jeonryag" class="header-anchor">#</a></h1><table>
<thead>
<tr>
<th>어노테이션</th>
<th>설명</th>
<th>부모 클래스</th>
<th>Bean</th>
</tr>
</thead>
<tbody><tr>
<td>@SpringBootTest</td>
<td>통합 테스트, 전체</td>
<td>IntegrationTest</td>
<td>Bean 전체</td>
</tr>
<tr>
<td>@WebMvcTest</td>
<td>단위 테스트, Mvc 테스트</td>
<td>MockApiTest</td>
<td>MVC 관련된 Bean</td>
</tr>
<tr>
<td>@DataJpaTest</td>
<td>단위 테스트, Jpa 테스트</td>
<td>RepositoryTest</td>
<td>JPA 관련 Bean</td>
</tr>
<tr>
<td>None</td>
<td>단위 테스트, Service 테스트</td>
<td>MockTest</td>
<td>None</td>
</tr>
<tr>
<td>None</td>
<td>POJO, 도메인 테스트</td>
<td>None</td>
<td>None</td>
</tr>
</tbody></table>
<h1><span id="tonghabteseuteu">통합테스트</span><a href="#tonghabteseuteu" class="header-anchor">#</a></h1><h2><span id="jangjeom">장점</span><a href="#jangjeom" class="header-anchor">#</a></h2><ul>
<li>모든 Bean을 올리고 테스트를 진행하기 때문에 쉽게 테스트 진행 가능</li>
<li>모든 Bean을 올리고 테스트를 진행하기 때문에 운영환경과 가장 유사하게 테스트 가능</li>
<li>API를 테스트할 경우 요청부터 응답까지 전체적인 테스트 진행 가능</li>
</ul>
<h2><span id="danjeom">단점</span><a href="#danjeom" class="header-anchor">#</a></h2><ul>
<li>모든 Bean을 올리고 테스트를 진행하기 때문에 테스트 시간이 오래 걸림</li>
<li>테스트의 단위가 크기 때문에 테스트 실패시 디버깅이 어려움</li>
<li>외부 API 콜같은 Rollback 처리가 안되는 테스트 진행을 하기 어려움</li>
</ul>
<h2><span id="code">Code</span><a href="#code" class="header-anchor">#</a></h2><h3><span id="integrationtest">IntegrationTest</span><a href="#integrationtest" class="header-anchor">#</a></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest(classes = ApiApp.class)</span></span><br><span class="line"><span class="meta">@AutoConfigureMockMvc</span></span><br><span class="line"><span class="meta">@ActiveProfiles(TestProfile.TEST)</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Ignore</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IntegrationTest</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span> <span class="keyword">protected</span> MockMvc mvc;</span><br><span class="line">    <span class="meta">@Autowired</span> <span class="keyword">protected</span> ObjectMapper objectMapper;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>통합 테스트의 Base 클래스입니다. Base 클래스를 통해서 테스트 전략을 통일성 있게 가져갈 수 있습니다.</li>
<li>통합 테스트는 주로 컨트롤러 테스트를 주로 하며 요청부터 응답까지의 전체 플로우를 테스트합니다.</li>
<li><code>@ActiveProfiles(TestProfile.TEST)</code> 설정으로 테스트에 profile을 지정합니다. 환경별로 properties 파일을 관리하듯이 test도 반드시 별도의 properties 파일로 관리하는 것이 바람직합니다.</li>
<li>인터페이스나 enum 클래스를 통해서 profile을 관리합니다. 오타 실수를 줄일 수 있으며 전체적인 프로필이 몇 개 있는지 한 번에 확인할 수 있습니다.</li>
<li><code>@Transactional</code> 트랜잭션 어노테이션을 추가하면 테스트코드의 데이터베이스 정보가 자동으로 Rollback 됩니다. 베이스 클래스에 이 속성을 추가 해야지 실수 없이 진행할 수 있습니다.</li>
<li><code>@Transactional</code>을 추가하면 자연스럽게 데이터베이스 상태의존 적인 테스트를 자연스럽게 하지 않을 수 있게 됩니다.</li>
<li>통합 테스트 시 필요한 기능들을 <code>protected</code>로 제공해줄 수 있습니다. API 테스트를 주로 하게 되니 ObjectMapper 등을 제공해줄 수 있습니다. 유틸성 메서드들도 <code>protected</code>로 제공해주면 중복 코드 및 테스트 코드의 편의성이 높아집니다.</li>
<li>실제로 동작할 필요가 없으니 <code>@Ignore</code> 어노테이션을 추가합니다.</li>
</ul>
<h3><span id="test-code">Test Code</span><a href="#test-code" class="header-anchor">#</a></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemberApiTest</span> <span class="keyword">extends</span> <span class="title class_">IntegrationTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MemberSetup memberSetup;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 회원가입_성공() <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//given</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">Member</span> <span class="variable">member</span> <span class="operator">=</span> MemberBuilder.build();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Email</span> <span class="variable">email</span> <span class="operator">=</span> member.getEmail();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Name</span> <span class="variable">name</span> <span class="operator">=</span> member.getName();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">SignUpRequest</span> <span class="variable">dto</span> <span class="operator">=</span> SignUpRequestBuilder.build(email, name);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//when</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">ResultActions</span> <span class="variable">resultActions</span> <span class="operator">=</span> requestSignUp(dto);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//then</span></span><br><span class="line">        resultActions</span><br><span class="line">                .andExpect(status().isOk())</span><br><span class="line">                .andExpect(jsonPath(<span class="string">&quot;email.value&quot;</span>).value(email.getValue()))</span><br><span class="line">                .andExpect(jsonPath(<span class="string">&quot;email.host&quot;</span>).value(email.getHost()))</span><br><span class="line">                .andExpect(jsonPath(<span class="string">&quot;email.id&quot;</span>).value(email.getId()))</span><br><span class="line">                .andExpect(jsonPath(<span class="string">&quot;name.first&quot;</span>).value(name.getFirst()))</span><br><span class="line">                .andExpect(jsonPath(<span class="string">&quot;name.middle&quot;</span>).value(name.getMiddle()))</span><br><span class="line">                .andExpect(jsonPath(<span class="string">&quot;name.last&quot;</span>).value(name.getLast()))</span><br><span class="line">                .andExpect(jsonPath(<span class="string">&quot;name.fullName&quot;</span>).value(name.getFullName()))</span><br><span class="line">        ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 회원조회() <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//given</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">Member</span> <span class="variable">member</span> <span class="operator">=</span> memberSetup.save();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//when</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">ResultActions</span> <span class="variable">resultActions</span> <span class="operator">=</span> requestGetMember(member.getId());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//then</span></span><br><span class="line">        resultActions</span><br><span class="line">                .andExpect(status().isOk())</span><br><span class="line">                .andExpect(jsonPath(<span class="string">&quot;email.value&quot;</span>).value(member.getEmail().getValue()))</span><br><span class="line">                .andExpect(jsonPath(<span class="string">&quot;email.host&quot;</span>).value(member.getEmail().getHost()))</span><br><span class="line">                .andExpect(jsonPath(<span class="string">&quot;email.id&quot;</span>).value(member.getEmail().getId()))</span><br><span class="line">                .andExpect(jsonPath(<span class="string">&quot;name.first&quot;</span>).value(member.getName().getFirst()))</span><br><span class="line">                .andExpect(jsonPath(<span class="string">&quot;name.middle&quot;</span>).value(member.getName().getMiddle()))</span><br><span class="line">                .andExpect(jsonPath(<span class="string">&quot;name.last&quot;</span>).value(member.getName().getLast()))</span><br><span class="line">                .andExpect(jsonPath(<span class="string">&quot;name.fullName&quot;</span>).value(member.getName().getFullName()))</span><br><span class="line">        ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ResultActions <span class="title function_">requestSignUp</span><span class="params">(SignUpRequest dto)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> mvc.perform(post(<span class="string">&quot;/members&quot;</span>)</span><br><span class="line">                .contentType(MediaType.APPLICATION_JSON_UTF8)</span><br><span class="line">                .content(objectMapper.writeValueAsString(dto)))</span><br><span class="line">                .andDo(print());</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>IntegrationTest</code> 클래스를 상속받습니다. 이 상속을 통해서 MemberApiTest에서 테스트를 위한 어노테이션이 생략되며 어떤 통합 테스트라도 항상 통일성을 가질 수 있습니다.</li>
<li><code>given</code>, <code>when</code>, <code>then</code> 키워드로 테스트 흐름을 알려줍니다. 다른 사람의 테스트 코드의 가독성이 높아지기 때문에 해당 키워드로 적절하게 표시하는 것을 권장합니다.</li>
<li>요청에 대한 메서드를 <code>requestSignUp(...)</code>으로 분리해서 재사용성을 높입니다. 해당 메서드로 valdate 실패하는 케이스도 작성합니다 <code>andDo(print())</code> 메서드를 추가해서 해당 요청에 대한 출력을 확인합니다. 디버깅에 매우 유용합니다.</li>
<li>모든 response에 대한 <code>andExpect</code>를 작성합니다. 간혹 <code>.andExpect(content().string(containsString(&quot;&quot;)))</code> 이런 테스트를 진행하는데 특정 문자열이 들어 있는지 없는지 확인하는 것은 것보다 모<ul>
<li><strong>response에 하나라도 빠지거나 변경되면 API 변경이 이루어진 것이고 그 변경에 맞게 테스트 코드도 변경되어야 합니다.</strong></li>
</ul>
</li>
<li><code>회원 조회</code> 테스트 강은 경우 <code>memberSetup.save();</code> 메서드로 테스트전에 데이터베이스에 insert 합니다. <ul>
<li>데이터베이스에 미리 있는 값을 검증하는 것은 데이터베이스 상태에 의존한 코드가 되며 누군가가 회원 정보를 변경하게 되면 테스트 코드가 실패하게 됩니다.</li>
<li>테스트 전에 데이터를 insert하지 않는다면 테스트 코드 구동 전에 <code>.sql</code> 으로 미리 데이터베이스를 준비시킵니다 ApplicationRunner를 이용해서 데이터베이스를 준비시키 방법도 있습니다.</li>
<li><strong>중요한 것은 데이터베이스 상태에 너무 의존적인 테스트는 향후 로직의 문제가 없더라도 테스트가 실패하는 상황이 자주 만나게 됩니다.</strong></li>
</ul>
</li>
</ul>
<h1><span id="seobiseu-teseuteu">서비스 테스트</span><a href="#seobiseu-teseuteu" class="header-anchor">#</a></h1><h2><span id="jangjeom">장점</span><a href="#jangjeom" class="header-anchor">#</a></h2><ul>
<li>진행하고자 하는 테스트에만 집중할 수 있습니다.</li>
<li>테스트 진행시 중요 관점이 아닌 것들은 Mocking 처리해서 외부 의존성들을 줄일 수 있습니다.<ul>
<li>예를 들어 주문 할인 로직이 제대로 동작하는지에 대한 테스트만 진행하지 이게 실제로 데이터베이스에 insert되는지는 해당 테스트의 관심사가 아닙니다.</li>
</ul>
</li>
<li>테스트 속도가 빠릅니다.</li>
</ul>
<h2><span id="danjeom">단점</span><a href="#danjeom" class="header-anchor">#</a></h2><ul>
<li>의존성 있는 객체를 Mocking 하기 때문에 문제가 완결된 테스트는 아닙니다.</li>
<li>Mocking 하기가 귀찮습니다.</li>
<li>Mocking 라이브러리에 대한 학습 비용이 발생합니다.</li>
</ul>
<h2><span id="code">Code</span><a href="#code" class="header-anchor">#</a></h2><h3><span id="mocktest">MockTest</span><a href="#mocktest" class="header-anchor">#</a></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(MockitoJUnitRunner.class)</span></span><br><span class="line"><span class="meta">@ActiveProfiles(TestProfile.TEST)</span></span><br><span class="line"><span class="meta">@Ignore</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MockTest</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>주로 Service 영역을 테스트 합니다. </li>
<li><code>MockitoJUnitRunner</code>을 통해서 Mock 테스트를 진행합니다.</li>
</ul>
<h3><span id="test-code">Test Code</span><a href="#test-code" class="header-anchor">#</a></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemberSignUpServiceTest</span> <span class="keyword">extends</span> <span class="title class_">MockTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@InjectMocks</span></span><br><span class="line">    <span class="keyword">private</span> MemberSignUpService memberSignUpService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mock</span></span><br><span class="line">    <span class="keyword">private</span> MemberRepository memberRepository;</span><br><span class="line">    <span class="keyword">private</span> Member member;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        member = MemberBuilder.build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 회원가입_성공() &#123;</span><br><span class="line">        <span class="comment">//given</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">Email</span> <span class="variable">email</span> <span class="operator">=</span> member.getEmail();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Name</span> <span class="variable">name</span> <span class="operator">=</span> member.getName();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">SignUpRequest</span> <span class="variable">dto</span> <span class="operator">=</span> SignUpRequestBuilder.build(email, name);</span><br><span class="line"></span><br><span class="line">        given(memberRepository.existsByEmail(any())).willReturn(<span class="literal">false</span>);</span><br><span class="line">        given(memberRepository.save(any())).willReturn(member);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//when</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">Member</span> <span class="variable">signUpMember</span> <span class="operator">=</span> memberSignUpService.doSignUp(dto);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//then</span></span><br><span class="line">        assertThat(signUpMember).isNotNull();</span><br><span class="line">        assertThat(signUpMember.getEmail().getValue()).isEqualTo(member.getEmail().getValue());</span><br><span class="line">        assertThat(signUpMember.getName().getFullName()).isEqualTo(member.getName().getFullName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test(expected = EmailDuplicateException.class)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 회원가입_이메일중복_경우() &#123;</span><br><span class="line">        <span class="comment">//given</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">Email</span> <span class="variable">email</span> <span class="operator">=</span> member.getEmail();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Name</span> <span class="variable">name</span> <span class="operator">=</span> member.getName();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">SignUpRequest</span> <span class="variable">dto</span> <span class="operator">=</span> SignUpRequestBuilder.build(email, name);</span><br><span class="line"></span><br><span class="line">        given(memberRepository.existsByEmail(any())).willReturn(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//when</span></span><br><span class="line">        memberSignUpService.doSignUp(dto);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>MockTest</code> 객체를 상속받아 테스트의 일관성을 갖습니다.</li>
<li><code>회원가입_성공</code> 테스트는 오직 회원 가입에대한 단위 테스트만 진행합니다.<ul>
<li><code>existsByEmail</code>을 모킹해서 해당 이메일이 중복되지 않았다는 가정을 합니다.</li>
<li><code>then</code> 에서는 회원 객체가 해당 비즈니스 요구사항에 맞게 생성됬는지를 검사합니다.</li>
<li>실제 데이터베이스에 Insert 됬는지 여부는 해당 테스트의 관심사가 아닙니다.</li>
</ul>
</li>
<li><code>회원가입_이메일중복_경우</code> 테스트는 회원가입시 이메일이 중복됬는지 여부를 확인합니다.<ul>
<li><code>existsByEmail</code>을 모킹해서 이메일이 중복됬다는 가정을 합니다.</li>
<li><code>expected</code>으로 이메일이 중복되었을 경우 <code>EmailDuplicateException</code> 예외가 발생하는지 확인합니다.</li>
<li>해당 이메일이 데이터베이스에 실제로 있어서 예외가 발생하는지는 관심사가 아닙니다. 작성한 코드가 제대로 동작 여부만이 해당 테스트의 관심사 입니다.</li>
</ul>
</li>
<li>오직 테스트의 관심사만 테스트를 진행하기 때문에 예외 발생시 디버깅 작업도 명확해집니다.</li>
<li>외부 의존도가 낮기 때문에 테스트 하고자하는 부분만 명확하게 테스트가 가능합니다.<ul>
<li>이것은 단점이기도 합니다. 해당 테스트만 진행하지 외부 의존을 갖는 코드까지 테스트하지 않으니 실제 환경에서 제대로 동작하지 않을 가능성이 있습니다. 외부 의존에대한 테스트는 통합 테스트에서 진행합니다.</li>
</ul>
</li>
</ul>
<h1><span id="mock-api-teseuteu">Mock API 테스트</span><a href="#mock-api-teseuteu" class="header-anchor">#</a></h1><h2><span id="jangjeom">장점</span><a href="#jangjeom" class="header-anchor">#</a></h2><ul>
<li>Mock 테스트와 장점은 거의 같습니다.</li>
<li><code>WebApplication</code> 관련된 Bean들만 등록하기 때문에 통합 테스트보다 빠르게 테스트할 수 있습니다.</li>
<li>통합 테스트를 진행하기 어려운 테스트를 진행합니다.<ul>
<li>외부 API 같은 Rollback 처리가 힘들거나 불가능한 테스트를 주로 사용합니다.</li>
<li>예를 들어 외부 결제 모듈 API를 콜하면 안 되는 케이스에서 주로 사용 할 수 있습니다.</li>
<li>이런 문제는 통합 테스트에서 해당 객체를 Mock 객체로 변경해서 테스트를 변경해서 테스트할 수도 있습니다.</li>
</ul>
</li>
</ul>
<h2><span id="danjeom">단점</span><a href="#danjeom" class="header-anchor">#</a></h2><ul>
<li>Mcok 테스트와 다점은 거의 같습니다.</li>
<li>요청부터 응답까지 모든 테스트를 Mock 기반으로 테스트하기 때문에 실제 환경에서는 제대로 동작하지 않을 가능성이 매우 큽니다.</li>
</ul>
<h2><span id="code">Code</span><a href="#code" class="header-anchor">#</a></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebMvcTest(MemberApi.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemberMockApiTest</span> <span class="keyword">extends</span> <span class="title class_">MockApiTest</span> &#123;</span><br><span class="line">    <span class="meta">@MockBean</span> <span class="keyword">private</span> MemberSignUpService memberSignUpService;</span><br><span class="line">    <span class="meta">@MockBean</span> <span class="keyword">private</span> MemberHelperService memberHelperService;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 회원가입_유효하지않은_입력값() <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//given</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">Email</span> <span class="variable">email</span> <span class="operator">=</span> Email.of(<span class="string">&quot;asdasd@d&quot;</span>); <span class="comment">// 이메일 형식이 유효하지 않음</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">Name</span> <span class="variable">name</span> <span class="operator">=</span> Name.builder().build();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">SignUpRequest</span> <span class="variable">dto</span> <span class="operator">=</span> SignUpRequestBuilder.build(email, name);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Member</span> <span class="variable">member</span> <span class="operator">=</span> MemberBuilder.build();</span><br><span class="line"></span><br><span class="line">        given(memberSignUpService.doSignUp(any())).willReturn(member);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//when</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">ResultActions</span> <span class="variable">resultActions</span> <span class="operator">=</span> requestSignUp(dto);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//then</span></span><br><span class="line">        resultActions</span><br><span class="line">                .andExpect(status().isBadRequest())</span><br><span class="line">        ;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>@WebMvcTest(MemberApi.class)</code> 어노테이션을 통해서 하고자하는 <code>MemberApi</code>의 테스트를 진행합니다.</li>
<li><code>@MockBean</code> 으로 객체를 주입받아 Mocking 작업을 진행합니다.</li>
<li>테스트의 관심사는 오직 Request와 그에 따른 Response 입니다.</li>
</ul>
<h1><span id="repository-test">Repository Test</span><a href="#repository-test" class="header-anchor">#</a></h1><h2><span id="jangjeom">장점</span><a href="#jangjeom" class="header-anchor">#</a></h2><ul>
<li><code>Repository</code> 관련된 Bean들만 등록하기 때문에 통합 테스트에 비해서 빠릅니다.</li>
<li><code>Repository</code>에 대한 관심사만 갖기 때문에 테스트 범위가 작습니다.</li>
</ul>
<h2><span id="danjeom">단점</span><a href="#danjeom" class="header-anchor">#</a></h2><ul>
<li>테스트 범위가 작기 때문에 실제 환경과 차이가 발생합니다.</li>
</ul>
<h2><span id="code">Code</span><a href="#code" class="header-anchor">#</a></h2><h3><span id="repositorytest">RepositoryTest</span><a href="#repositorytest" class="header-anchor">#</a></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@DataJpaTest</span></span><br><span class="line"><span class="meta">@ActiveProfiles(TestProfile.TEST)</span></span><br><span class="line"><span class="meta">@AutoConfigureTestDatabase(replace = AutoConfigureTestDatabase.Replace.NONE)</span></span><br><span class="line"><span class="meta">@Ignore</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RepositoryTest</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>@DataJpaTest</code> 어노테이션을 통해서 <code>Repository</code>에 대한 Bean만 등록합니다.</li>
<li><code>@DataJpaTest</code>는 기본적으로 메모리 데이터베이스에 대한 테스트를 진행합니다. <code>@AutoConfigureTestDatabase</code> 어노테이션을 통해서 profile에 등록된 데이터베이스 정보로 대체할 수 있습니다.</li>
<li><code>JpaRepository</code>에서 기본적으로 기본적으로 제공해주는 <code>findById</code>, <code>findByAll</code>, <code>deleteById</code>등은 테스트를 하지 않습니다.<ul>
<li>기본적으로 <code>save()</code> null 제약 조건등의 테스트는 진행해도 좋다고 생각합니다.</li>
<li>주로 커스텀하게 작성한 쿼리 메서드, <code>@Query</code>으로 작성된 JPQL등의 커스텀하게 추가된 메서드를 테스트합니다.</li>
</ul>
</li>
</ul>
<h3><span id="test-code">Test Code</span><a href="#test-code" class="header-anchor">#</a></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemberRepositoryTest</span> <span class="keyword">extends</span> <span class="title class_">RepositoryTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MemberRepository memberRepository;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Member saveMember;</span><br><span class="line">    <span class="keyword">private</span> Email email;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> <span class="string">&quot;cheese10yun@gmail.com&quot;</span>;</span><br><span class="line">        email = EmailBuilder.build(value);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Name</span> <span class="variable">name</span> <span class="operator">=</span> NameBuilder.build();</span><br><span class="line">        saveMember = memberRepository.save(MemberBuilder.build(email, name));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> existsByEmail_존재하는경우_true() &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">boolean</span> <span class="variable">existsByEmail</span> <span class="operator">=</span> memberRepository.existsByEmail(email);</span><br><span class="line">        assertThat(existsByEmail).isTrue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> existsByEmail_존재하지않은_경우_false() &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">boolean</span> <span class="variable">existsByEmail</span> <span class="operator">=</span> memberRepository.existsByEmail(Email.of(<span class="string">&quot;ehdgoanfrhkqortntksdls@asd.com&quot;</span>));</span><br><span class="line">        assertThat(existsByEmail).isFalse();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>setUp()</code> 메서드를 통해서 Member를 데이터베이스에 insert 합니다.<ul>
<li><code>setUp()</code> 메서드는 메번 테스트 코드가 실행되기전에 실행됩니다. 즉 테스트 코드 실핼 할 때마다 insert -&gt; rollback이 자동으로 이루어집니다.</li>
</ul>
</li>
<li>추가 작성한 쿼리 메서드 <code>existsByEmail</code>을 테스트 진행합니다. <ul>
<li>실제로 작성된 쿼리가 어떻게 출력되는지 <code>show-sql</code> 옵션을 통해서 확인 합니다. ORM은 SQL을 직접 장성하지 않으니 실제 쿼리가 어떻게 출력되는지 확인하는 습관을 반드시 가져야합니다.</li>
</ul>
</li>
</ul>
<h1><span id="pojo-teseuteu">POJO 테스트</span><a href="#pojo-teseuteu" class="header-anchor">#</a></h1><h2><span id="seolmyeong">설명</span><a href="#seolmyeong" class="header-anchor">#</a></h2><p>각 엔티티(Embeddable, Entity, 일반 POJO, 모든 객체) 객체들의 기능이 풍부해야 합니다. 객체 본인의 책임을 충분히 다하지 않고 있으면 다른 영역으로 그 객체의 책임이 넘어 가게됩니다. 예를 들어 <code>Name</code> 객체가 <code>getFullName()</code> 메서드를 제공해주지 않는다면 <code>getFullName()</code> 메서드를 만족시키는 메서드들이 다른 계층에서 구현하게 되고 어느 계층에서 어떻게 사용되고 있는지 모르기 때문에 누군가는 중복코드를 만들게 됩니다.</p>
<p>객체지향에서 본인의 책임(기능)은 본인 스스로가 제공해야 합니다. 특히 엔티티 객체들은 가장 핵심 객체이고 이 객체를 사용하는 계층들이 다양하게 분포되기 때문에 반드시 테스트 코드를 작성해야합니다.</p>
<h2><span id="jangjeom">장점</span><a href="#jangjeom" class="header-anchor">#</a></h2><ul>
<li>POJO 객체이므로 테스트하기 편합니다. 외부에서 주입 받을 의존성도 없고 Mocking할 대상도 없습니다.</li>
<li>엔티티 객체는 사용하는 계층이 많으므로 테스트의 효율성이 높습니다.</li>
</ul>
<h2><span id="danjeom">단점</span><a href="#danjeom" class="header-anchor">#</a></h2><ul>
<li>단점은 없다고 생각합니다. POJO를 테스트 하므로 테스트 속도 및 난도가 낮지만 높은 안전성을 갖게 됩니다.</li>
</ul>
<h2><span id="code">Code</span><a href="#code" class="header-anchor">#</a></h2><h3><span id="embeddable">Embeddable</span><a href="#embeddable" class="header-anchor">#</a></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Embeddable</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@NoArgsConstructor(access = AccessLevel.PROTECTED)</span></span><br><span class="line"><span class="meta">@ToString(of = &#123;&quot;first&quot;, &quot;middle&quot;, &quot;last&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Name</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotEmpty</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;first_name&quot;, length = 50)</span></span><br><span class="line">    <span class="keyword">private</span> String first;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;middle_name&quot;, length = 50)</span></span><br><span class="line">    <span class="keyword">private</span> String middle;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotEmpty</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;last_name&quot;, length = 50)</span></span><br><span class="line">    <span class="keyword">private</span> String last;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Builder</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Name</span><span class="params">(<span class="keyword">final</span> String first, <span class="keyword">final</span> String middle, <span class="keyword">final</span> String last)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.first = first;</span><br><span class="line">        <span class="built_in">this</span>.middle = StringUtils.isEmpty(middle) ? <span class="literal">null</span> : middle;</span><br><span class="line">        <span class="built_in">this</span>.last = last;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getFullName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.middle == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> String.format(<span class="string">&quot;%s %s&quot;</span>, <span class="built_in">this</span>.first, <span class="built_in">this</span>.last);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> String.format(<span class="string">&quot;%s %s %s&quot;</span>, <span class="built_in">this</span>.first, <span class="built_in">this</span>.middle, <span class="built_in">this</span>.last);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>Name</code> 객체는 <code>Member</code> 객체에서 사용하고 있습니다. 이처럼 Name 이라는 객체를 <code>Embeddable</code>으로 별도로 가지고 있으면 데이터의 응집력 재사용성이 높아집니다.<ul>
<li>예를 들어 주문시 주문자 정보를 받아야 된다면 <code>Order</code> 라는 객체에도 동일하게 <code>Name</code> 객체를 사용하면 재사용성이 높아집니다.</li>
</ul>
</li>
<li><code>Embeddable</code> 객체에서도 다른 객체와 마찬가지로 <code>Name</code> 관련된 기능을 충분히 제공해야 합니다. <code>getFullName()</code> 메서드 처럼 <code>first</code>, <code>last</code>, <code>middle</code>의 이름을 적절하게 조합해서 제공해줍니다.</li>
</ul>
<h3><span id="test-code">Test Code</span><a href="#test-code" class="header-anchor">#</a></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NameTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getFullName_isFullName_ReturnFullName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Name</span> <span class="variable">name</span> <span class="operator">=</span> Name.builder()</span><br><span class="line">                .first(<span class="string">&quot;first&quot;</span>)</span><br><span class="line">                .middle(<span class="string">&quot;middle&quot;</span>)</span><br><span class="line">                .last(<span class="string">&quot;last&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">fullName</span> <span class="operator">=</span> name.getFullName();</span><br><span class="line">        assertThat(fullName, is(<span class="string">&quot;first middle last&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getFullName_WithoutMiddle_ReturnMiddleNameIsNull</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Name</span> <span class="variable">name</span> <span class="operator">=</span> Name.builder()</span><br><span class="line">                .first(<span class="string">&quot;first&quot;</span>)</span><br><span class="line">                .middle(<span class="string">&quot;&quot;</span>)</span><br><span class="line">                .last(<span class="string">&quot;last&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">fullName</span> <span class="operator">=</span> name.getFullName();</span><br><span class="line">        assertThat(fullName, is(<span class="string">&quot;first last&quot;</span>));</span><br><span class="line">        assertThat(name.getMiddle(), is(nullValue()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getFullName_MiddleNameIsNull_ReturnMiddleNameIsNull</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Name</span> <span class="variable">name</span> <span class="operator">=</span> Name.builder()</span><br><span class="line">                .first(<span class="string">&quot;first&quot;</span>)</span><br><span class="line">                .middle(<span class="string">&quot;&quot;</span>)</span><br><span class="line">                .last(<span class="string">&quot;last&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">fullName</span> <span class="operator">=</span> name.getFullName();</span><br><span class="line">        assertThat(fullName, is(<span class="string">&quot;first last&quot;</span>));</span><br><span class="line">        assertThat(name.getMiddle(), is(nullValue()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>entity</code>, <code>Embeddable</code> 객체 등의 객체들도 반드시 테스트 코드를 작성해야합니다.</li>
<li>middle 값이 비어있을 경우 null로 잘들어가는지, <code>getFullName()</code> 메서드가 잘 동작하는지 테스트합니다.</li>
</ul>
<h1><span id="mamuri">마무리</span><a href="#mamuri" class="header-anchor">#</a></h1><p>각자의 프로젝트 환경이 다르기 때문에 어느 한방 법이 Best Practice라고 말하는 게 어렵습니다. 그래도 테스트 코드의 중요성은 이미 많은 개발자가 공감하고 있는 만큼 보다 효율적인 테스트 코드 환경을 구축하려는 노력이 많이 선행되어야 한다고 생각합니다.</p>

            


        </div>
    </div>
    <!-- Table of Contents -->
    <div id="toc-container">
        <div class="toc-title">목차</div>
        <ul id="toc-list"></ul>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">태그</span><br/>
                
    <a class="tag tag--primary tag--small t-none-link" href="/tags/Spring/" rel="tag">Spring</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/Test/" rel="tag">Test</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/spring-guide-exception/"
                    data-tooltip="Spring Guide - Exception 전략"
                    aria-label="이전: Spring Guide - Exception 전략"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">이전</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/spring-jpa-best-15/"
                    data-tooltip="Spring JPA Best Practices step-15 - Querydsl를 이용해서 Repository 확장하기 (1)"
                    aria-label="다음: Spring JPA Best Practices step-15 - Querydsl를 이용해서 Repository 확장하기 (1)"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">다음</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="이 포스트 공유하기"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://cheese10yun.github.io/spring-guide-test-1/"
                    title="Facebook에 공유하기"
                    aria-label="Facebook에 공유하기"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://cheese10yun.github.io/spring-guide-test-1/"
                    title="Twitter에 공유하기"
                    aria-label="Twitter에 공유하기"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="맨 위로">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        

                
                    <!--  utteranc comment -->

<script src="https://utteranc.es/client.js"
        repo="cheese10yun/blog-comment"
        issue-term="title"
        label="Comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>

                

            
        
    </div>
</article>


                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2026 Yun. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/spring-guide-exception/"
                    data-tooltip="Spring Guide - Exception 전략"
                    aria-label="이전: Spring Guide - Exception 전략"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">이전</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/spring-jpa-best-15/"
                    data-tooltip="Spring JPA Best Practices step-15 - Querydsl를 이용해서 Repository 확장하기 (1)"
                    aria-label="다음: Spring JPA Best Practices step-15 - Querydsl를 이용해서 Repository 확장하기 (1)"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">다음</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="이 포스트 공유하기"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://cheese10yun.github.io/spring-guide-test-1/"
                    title="Facebook에 공유하기"
                    aria-label="Facebook에 공유하기"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://cheese10yun.github.io/spring-guide-test-1/"
                    title="Twitter에 공유하기"
                    aria-label="Twitter에 공유하기"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="맨 위로">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="5">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=https://cheese10yun.github.io/spring-guide-test-1/"
                        aria-label="Facebook에 공유하기"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Facebook에 공유하기</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=https://cheese10yun.github.io/spring-guide-test-1/"
                        aria-label="Twitter에 공유하기"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Twitter에 공유하기</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/yun-icon.jpg" alt="저자 이미지"/>
        
            <h4 id="about-card-name">Yun</h4>
        
            <div id="about-card-bio"><p>기술 블로그</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/jquery.js"></script>


<script src="/assets/js/jquery.fancybox.js"></script>


<script src="/assets/js/thumbs.js"></script>


<script src="/assets/js/tranquilpeak.js"></script>



<script src="/assets/js/toc.js"></script>


<!--SCRIPTS END-->


    




    </body>
</html>
